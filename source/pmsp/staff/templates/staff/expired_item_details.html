{% extends 'staff_base.html' %}

{% block css %}

  <style>
    #expired_item_details
    {
      border-top-left-radius: 25px;
      border-top-right-radius: 25px;
      color: #F0F8FF;
      background-color: #00631b;
    }
  </style>

{% endblock %}


{% block title %}Expired Items{% endblock %}


{% block content %}

  <form style="margin:20px;">

    <div class="input-group w-auto justify-content-end align-items-center">

      <label class="fw-bold fs-5" for="month">Month:</label>
      <input style="margin:10px; border-color:#000000; border-radius:10px;" class="form-control" type="number" step="1" min="1" max="12" placeholder="Month" id="month" name="month" class="quantity-field border-0 text-center w-25" required>

      <label class="fw-bold fs-5" for="year">Year:</label>
      <input style="margin:10px; border-color:#000000; border-radius:10px;" class="form-control" type="number" step="1" min="1970" placeholder="Year" id="year" name="year" class="quantity-field border-0 text-center w-25" required>

    </div>

    <button class="btn btn-primary" style=" margin:10px;" type="submit">
      Get Expired Items
    </button>

  </form>

  {% if month_entered and year_entered %}

    {% if expired_items %}

      <div class="row" style="vertical-align: middle; ">

        <div class="col-sm-11 my-auto">

        </div>

        <div class="col-sm-1 my-auto">

          <button class="btn btn-info" type="button" onclick="PrintTable();" value="Print">

            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
              <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
              <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
            </svg>

            Print

          </button>

        </div>

      </div>

      <div class="card" style="margin:30px; width: 80rem; border-color:#000000;">

        <div class="card-header">

          <p style="margin:10px; color:#0000ff;" class="fw-bold fs-4">
            Expired Items for the month {{ month_entered }} and year {{ year_entered }}
          </p>

        </div>

        <div class="card-body">

          <table class="table table-striped table-bordered" style="border-color:#000000;">

            <thead class="table-dark">
              <tr>
                <th scope="col">Item ID</th>
                <th scope="col">Item Name</th>
                <th scope="col">Expiry Date</th>
                <th scope="col">Quantity at time of Arrival</th>
                <th scope="col">Quantity Expired</th>
              </tr>
            </thead>

            <tbody>

              {% for item in expired_items %}

                <tr>
                  <td>{{ item.id }}</td>
                  <td>{{ item.medicine_id }}</td>
                  <td>{{ item.expiry_date }}</td>
                  <td>{{ item.quantity_at_time_of_arrival }}</td>
                  <td>{{ item.expired_quantity }}</td>
                </tr>

              {% endfor %}

            </tbody>

          </table>

        </div>

      </div>


      </br>

      </br>

      </br>

      </br>

      </br>


      <iframe name="print_frame" width="0" height="0" frameborder="0" src="about:blank">

      </iframe>

      <div id="dvContents" style="margin:20px;" hidden>

        <h3>

          Expired Items for the month {{ month_entered }} and year {{ year_entered }}

        </h3>

        <h3>

          Generated by {{ staff_object }} Staff ID {{ staff_id }}

        </h3>

        <footer class="footer_content">
          Generated on
          <span id='date-time'>

          </span>
        </footer>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <div class="card" style="margin:30px; width: 60rem; border-color:#000000;">

          <div class="card-header">

            <p style="margin:10px; color:#0000ff;" class="fw-bold fs-4">
              Expired Items for the month {{ month_entered }} and year {{ year_entered }}
            </p>

          </div>

          <div class="card-body">

            <table class="table table-striped table-bordered" style="border-color:#000000;">

              <thead>
                <tr>
                  <th scope="col">Item ID</th>
                  <th scope="col">Item Name</th>
                  <th scope="col">Expiry Date</th>
                  <th scope="col">Quantity at time of Arrival</th>
                  <th scope="col">Quantity Expired</th>
                </tr>
              </thead>

              <tbody>

                {% for item in expired_items %}

                  <tr>
                    <td>{{ item.id }}</td>
                    <td>{{ item.medicine_id }}</td>
                    <td>{{ item.expiry_date }}</td>
                    <td>{{ item.quantity_at_time_of_arrival }}</td>
                    <td>{{ item.expired_quantity }}</td>
                  </tr>

                {% endfor %}

              </tbody>

            </table>

          </div>

        </div>

      </div>

    {% else %}

          <p style="margin:20px; color:#ff0000;" class="fw-bold fs-5">

              No Expired Items for the month {{ month_entered }} and year {{ year_entered }}

          </p>

    {% endif %}

  {% endif %}



<script>

  n =  new Date();
  y = n.getFullYear();
  m = n.getMonth() + 1;
  d = n.getDate();

  document.getElementById("year").setAttribute("max", y);

</script>

<script type="text/javascript">

    function PrintTable()
    {

        window.frames["print_frame"].document.body.innerHTML = document.getElementById("dvContents").innerHTML;

        window.frames["print_frame"].window.focus();

        window.frames["print_frame"].window.print();

    }

</script>

<script>

  var dt = new Date();

  document.getElementById('date-time').innerHTML=dt;

</script>


{% endblock %}